version: "3.7"

networks:
  spring-cloud-network: 
    external:
      name: spring-cloud-network
      
services:
  config-service:
    hostname: config-service
    image: macoredroid/config-service:latest
    networks:
      - spring-cloud-network
    ports:
      - "8088:8088"
    environment:
      SPRING_APPLICATION_JSON: '{"spring": {"cloud": {"config": {"server": {"git" :{"uri": "https://github.com/MaCoredroid/test-config-docker.git"}}}}}}'
    deploy:
      resources:
        limits:
          memory: 500M 
        reservations:
          memory: 200M
      restart_policy:
        condition: on-failure
        delay: 5s
        max_attempts: 100
        window: 120s

  mysql-pet:
    hostname: mysql-pet
    image: mysql:latest
    networks:
      - spring-cloud-network
    environment:
      - MYSQL_ROOT_PASSWORD=c7o2r1e4
      - MYSQL_DATABASE=pet
      - MYSQL_USER=coredroid
      - MYSQL_PASSWORD=c7o2r1e4
    ports:
      - "3306:3306"
  

  mysql-user:
    hostname: mysql-user
    image: mysql:latest
    networks:
      - spring-cloud-network
    environment:
      - MYSQL_ROOT_PASSWORD=c7o2r1e4
      - MYSQL_DATABASE=pet
      - MYSQL_USER=coredroid
      - MYSQL_PASSWORD=c7o2r1e4
    ports:
      - "3307:3306"
  

  mysql-record:
    hostname: mysql-record
    image: mysql:latest
    networks:
      - spring-cloud-network
    environment:
      - MYSQL_ROOT_PASSWORD=c7o2r1e4
      - MYSQL_DATABASE=pet
      - MYSQL_USER=coredroid
      - MYSQL_PASSWORD=c7o2r1e4
    ports:
      - "3308:3306"

  mysql-location:
    hostname: mysql-location
    image: mysql:latest
    networks:
      - spring-cloud-network
    environment:
      - MYSQL_ROOT_PASSWORD=c7o2r1e4
      - MYSQL_DATABASE=pet
      - MYSQL_USER=coredroid
      - MYSQL_PASSWORD=c7o2r1e4
    ports:
      - "3309:3306"
      
  mysql-rule:
    hostname: mysql-rule
    image: mysql:latest
    networks:
      - spring-cloud-network
    environment:
      - MYSQL_ROOT_PASSWORD=c7o2r1e4
      - MYSQL_DATABASE=pet
      - MYSQL_USER=coredroid
      - MYSQL_PASSWORD=c7o2r1e4
    ports:
      - "3310:3306"

  discovery-service:
    hostname: discovery-service
    image: macoredroid/discovery-service:latest
    networks:
      - spring-cloud-network
    environment:
      SPRING_APPLICATION_JSON: '{"spring": {"cloud": {"config": {"uri": "http://config-service:8088"}}}}'
    ports:
      - "30752:30752"
    deploy:
      resources:
        limits:
          memory: 500M 
        reservations:
          memory: 200M
      restart_policy:
        condition: on-failure
        delay: 5s
        max_attempts: 100
        window: 120s
  
  pet-service:
    hostname: pet-service
    image: macoredroid/pet-service:latest
    networks:
      - spring-cloud-network
    depends_on:
      - mysql-pet
    environment:
      SPRING_APPLICATION_JSON: '{"spring": {"cloud": {"config": {"uri": "http://config-service:8088"}}}}'
    deploy:
      resources:
        limits:
          memory: 500M 
        reservations:
          memory: 200M
      restart_policy:
        condition: on-failure
        delay: 5s
        max_attempts: 100
        window: 120s

  user-service:
    hostname: user-service
    image: macoredroid/user-service:latest
    networks:
      - spring-cloud-network
    depends_on:
      - mysql-user
      - mongo-cover
    environment:
      SPRING_APPLICATION_JSON: '{"spring": {"cloud": {"config": {"uri": "http://config-service:8088"}}}}'
    deploy:
      resources:
        limits:
          memory: 500M 
        reservations:
          memory: 200M
      restart_policy:
        condition: on-failure
        delay: 5s
        max_attempts: 100
        window: 120s

  record-service:
    hostname: record-service
    image: macoredroid/record-service:latest
    networks:
      - spring-cloud-network
    depends_on:
      - mysql-record
    environment:
      SPRING_APPLICATION_JSON: '{"spring": {"cloud": {"config": {"uri": "http://config-service:8088"}}}}'
    deploy:
      resources:
        limits:
          memory: 500M 
        reservations:
          memory: 200M
      restart_policy:
        condition: on-failure
        delay: 5s
        max_attempts: 100
        window: 120s

  location-service:
    hostname: location-service
    image: macoredroid/location-service:latest
    networks:
      - spring-cloud-network
    depends_on:
      - mysql-record
    environment:
      SPRING_APPLICATION_JSON: '{"spring": {"cloud": {"config": {"uri": "http://config-service:8088"}}}}'
    deploy:
      resources:
        limits:
          memory: 500M 
        reservations:
          memory: 200M
      restart_policy:
        condition: on-failure
        delay: 5s
        max_attempts: 100
        window: 120s
      
  proxy-service:
    hostname: proxy-service
    image: macoredroid/proxy-service:latest
    networks:
      - spring-cloud-network
    environment:
      SPRING_APPLICATION_JSON: '{"spring": {"cloud": {"config": {"uri": "http://config-service:8088"}}}}'
    ports:
      - "30751:30751"
    deploy:
      resources:
        limits:
          memory: 700M 
        reservations:
          memory: 200M
      restart_policy:
        condition: on-failure
        delay: 5s
        max_attempts: 100
        window: 120s
      
  rule-service:
    hostname: rule-service
    image: macoredroid/rule-service:latest
    networks:
      - spring-cloud-network
    environment:
      SPRING_APPLICATION_JSON: '{"spring": {"cloud": {"config": {"uri": "http://config-service:8088"}}}}'
    depends_on:
      - mysql-rule
    deploy:
      resources:
        limits:
          memory: 500M 
        reservations:
          memory: 200M
      restart_policy:
        condition: on-failure
        delay: 5s
        max_attempts: 100
        window: 120s
      
  mongo-moment:
    hostname: mongo-moment
    networks:
      - spring-cloud-network
    image: mongo
    ports:
      - "27017:27017"
      
  mongo-cover:
    hostname: mongo-cover
    networks:
      - spring-cloud-network
    image: mongo
    ports:
      - "27018:27017"
    
  
  forum-service:
    image: macoredroid/forum-service:latest
    environment:
      SPRING_APPLICATION_JSON: '{"spring": {"cloud": {"config": {"uri": "http://config-service:8088"}}}}'
    networks:
      - spring-cloud-network
    deploy:
      resources:
        limits:
          memory: 500M 
        reservations:
          memory: 200M
      restart_policy:
        condition: on-failure
        delay: 5s
        max_attempts: 100
        window: 120s
 
    
    

        
 
